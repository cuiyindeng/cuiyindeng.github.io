---
title: 关于SQL中的索引
date: 2018-11-13 20:23:10
tags:
---

索引是存储引擎用于快速查找数据记录的一种数据结构。可以比作为书的“目录”。

<!-- more -->

### 索引分类

#### 按照数据结构

- B+Tree索引
- Hash索引

#### 按照定义

- 普通索引；列值允许空值和重复值。
- 唯一索引；列值不允许有重复值。
- 单列索引；由单个列组成的索引。
- 多列索引；由多个列组成的索引，以最左边的列为准，查询条件中必须出现最左边的列。
- 全文索引；索引的列上支持全文查找。
- 空间索引；对空间数据类型的列建立的索引。只能用在MyISAM引擎中。

#### 按照存储方式

*一些概念：*
*叶子结点也叫终端结点，就是没有子结点的结点*
*主键索引是系统创建的索引；二级索引是自定义的索引*

- 聚簇索引
	- 表数据是和索引数据（主键）是存储在一起的。
	- 主键索引的叶子结点存储了行数据，并包含主键值。
	- 二级索引的叶子结点存储了行的主键值。
	- InnoDB的索引存储机制，使用的是聚簇索引。
	- InnoDB的表数据文件就是一个由B+Tree数据结构组成的一个索引文件。

> InnoDB要求表必须有主键（MyISAM可以没有）;
> 如果没有显式指定，则MySQL系统会自动选择一个可以唯一标识数据记录的列作为主键;
> 如果不存在这种列，则MySQL自动为InnoDB表生成一个隐含字段作为主键，这个字段长度为6个字节，类型为长整形

- 非聚簇索引
	- 表数据和索引数据是分开存储的。
	- 主键索引的叶子结点存储的是行数据的地址。
	- 二级索引同上
	- MyISAM的索引存储机制，使用的是非聚簇索引。也是由B+Tree数据结构组成的索引文件。
### 创建原则

1. 索引并非越多越好
2. 数据量小的表不要建索引
3. 在重复值多的列上不要建索引。（位图索引？）
4. 对于经常查询的字段创建索引
5. 数据唯一时创建唯一索引
6. 在频繁进行排序和分组的列上建立索引

### 使用注意点

1. 使用多列索引时，注意最左匹配原则。MySQL在匹配索引时，会一直向右匹配，只要匹配到索引，查询就会走索引；直到遇到范围查询（<，>，between，like），就停止匹配；索引创建索引时，用到范围查询的列要放在最右边。
2. 使用多列索引时，MySQL的查询优化器会优化索引的使用顺序。in和=可以乱序使用多列索引。
3. 索引列用于函数、算术运算时，不会使用索引。
4. 对索引列进行is null、is not null判断，不会使用索引。
5. or操作符，不会使用索引。
6. 查询参数的数据类型和索引列的数据类型不一致时，不会走索引。
7. 负向查询（not , not in, not like, <>, != ,!>,!< ）不会使用索引。
8. like操作符的全模糊'%a%'和左模糊'%a'，不会使用索引。
9. 使用多列索引时，索引的第一列必须出现在查询条件中，否则不会走索引。

### 优点和缺点

优点 | 缺点
-----|-----
唯一索引可以保证每行数据的唯一性 | 创建和更新索引消耗时间
可以加快数据的检索速度 | 占用存储空间
加快表与表之间的连接速度 | 表中数据变动会引起索引变动
减少查询中排序和分组的时间 | 

### 一些深入的问题

#### 为什么查询快？

#### 为什么删除和更新操作慢？